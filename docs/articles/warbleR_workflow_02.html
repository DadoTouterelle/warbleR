<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<center>
<font size="7"><b>warbleR: Visual inspection and signal classification</b></font>
</center> • warbleR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="&lt;center&gt;
&lt;font size=">
</head>
<body>
<b>warbleR: Visual inspection and signal classification</b>
" /&gt;

<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">warbleR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.16</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/warbleR_workflow_01.html">&lt;center&gt;&lt;font size="7"&gt;&lt;b&gt;warbleR&amp;#58; Import sound files and select signals&lt;/b&gt;&lt;/font&gt;&lt;/center&gt;</a>
    </li>
    <li>
      <a href="../articles/warbleR_workflow_02.html">&lt;center&gt;&lt;font size="7"&gt;&lt;b&gt;warbleR&amp;#58; Visual inspection and signal classification&lt;/b&gt;&lt;/font&gt;&lt;/center&gt;</a>
    </li>
    <li>
      <a href="../articles/warbleR_workflow_03.html">&lt;center&gt;&lt;font size="7"&gt;&lt;b&gt;warbleR&amp;#58; Acoustic (dis)similarity, coordinated singing and simulating songs&lt;/b&gt;&lt;/font&gt;&lt;/center&gt;</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1><center>
<font size="7"><b>warbleR: Visual inspection and signal classification</b></font>
</center></h1>
                        <h4 class="author"><center>
<a href="http://marceloarayasalas.weebly.com/">Marcelo Araya-Salas, PhD</a>
</center></h4>
                        <h4 class="author"><center>
<a href="http://smithvidaurre.weebly.com/">Grace Smith-Vidaurre, PhD Candidate</a>
</center></h4>
            
            <h4 class="date"><center>
“2019-06-20”
</center></h4>
      
      
      <div class="hidden name"><code>warbleR_workflow_02.Rmd</code></div>

    </div>

    
    
<p> </p>
<center>
<img src="logo.png" alt="warbleR logo">
</center>
<p> </p>
<!-- <center> <h1><b>Visual inspection and classification of signals</h1></b> </center> -->
<!-- <center> <i><font size="4">Marcelo Araya-Salas and Grace Smith Vidaurre</font></i> </center> -->
<!-- <center> 2019-06-20 </center> -->
<div id="bioacoustics-in-r-with-warbler" class="section level2">
<h2 class="hasAnchor">
<a href="#bioacoustics-in-r-with-warbler" class="anchor"></a>Bioacoustics in R with <code>warbleR</code>
</h2>
<p>Bioacoustics research encompasses a wide range of questions, study systems and methods, including the software used for analyses. The <code>warbleR</code> and <code>Rraven</code> packages leverage the flexibility of the <code>R</code> environment to offer a broad and accessible bioinformatics tool set. These packages fundamentally rely upon two types of data to begin bioacoustic analyses in R:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Sound files:</strong> Recordings in <em>wav</em> or <em>mp3</em> format, either from your own research or open-access databases like <em>xeno-canto</em></p></li>
<li><p><strong>Selection tables:</strong> Selection tables contain the temporal coordinates (start and end points) of selected acoustic signals within recordings</p></li>
</ol>
<div id="package-repositories" class="section level3">
<h3 class="hasAnchor">
<a href="#package-repositories" class="anchor"></a>Package repositories</h3>
<p>These packages are both available on <em>CRAN</em>: <a href="https://cran.r-project.org/package=warbleR"><code>warbleR</code></a>, <a href="https://cran.r-project.org/package=Rraven"><code>Rraven</code></a>, as well as on <em>GitHub</em>: <a href="https://github.com/maRce10/warbleR"><code>warbleR</code></a>, <a href="https://github.com/maRce10/Rraven"><code>Rraven</code></a>. The GitHub repository will always contain the latest functions and updates. You can also check out an article in <em>Methods in Ecology and Evolution</em> documenting the <code>warbleR</code> package <a href="#References"><sup>[1]</sup></a>.</p>
<p>We welcome all users to provide feedback, contribute updates or new functions and report bugs to warbleR’s GitHub repository.</p>
<p>Please note that <code>warbleR</code> and <code>Rraven</code> use functions from the <a href="https://cran.r-project.org/package=seewave"><code>seewave</code></a>, <a href="https://cran.r-project.org/package=monitoR"><code>monitoR</code></a>, <a href="https://cran.r-project.org/package=tuneR"><code>tuneR</code></a> and <a href="https://cran.r-project.org/package=dtw"><code>dtw</code></a> packages internally. <code>warbleR</code> and <code>Rraven</code> have been designed to make bioacoustics analyses more accessible to <code>R</code> users, and such analyses would not be possible without the tools provided by the packages above. These packages should be given credit when using <code>warbleR</code> and <code>Rraven</code> by including citations in publications as appropriate (e.g. <code><a href="https://www.rdocumentation.org/packages/utils/topics/citation">citation("seewave")</a></code>).</p>
</div>
<div id="parallel-processing-in-warbler" class="section level3">
<h3 class="hasAnchor">
<a href="#parallel-processing-in-warbler" class="anchor"></a>Parallel processing in <code>warbleR</code>
</h3>
<p>Parallel processing, or using multiple cores on your machine, can greatly speed up analyses. All iterative <code>warbleR</code> functions now have parallel processing for Linux, Mac and Windows operating systems. These functions also contain progress bars to visualize progress during normal or parallel processing. See <a href="#References"><sup>[1]</sup></a> for more details about improved running time using parallel processing.</p>
</div>
</div>
<div id="vignette-introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#vignette-introduction" class="anchor"></a><strong>Vignette introduction</strong>
</h2>
<p>In the previous vignette, we used the <code>Rraven</code> package to import <em>Raven</em> selection tables for recordings in our working directory, added more recordings to the data set by downloading new sound files from the open-access <code>xeno-canto</code> database and reviewed methods of automated and manual signal selection in <code>warbleR</code>. Here we continue with the case study of microgeographic vocal variation in long-billed hermit hummingbirds, <em>Phaethornis longirostris</em> <a href="#References"><sup>[2]</sup></a> by:</p>
<ol style="list-style-type: decimal">
<li><p>Performing quality control processing on selected signals, including visual inspection and tailoring temporal coordinates</p></li>
<li><p>Making lexicons for visual classification of signals</p></li>
</ol>
<p>This vignette can be run without an advanced understanding of <code>R</code>, as long as you know how to run code in your console. However, knowing more about basic <code>R</code> coding would be very helpful to modify the code for your research questions.</p>
<p>For more details about function arguments, input or output, read the documentation for the function in question (e.g. <code><a href="../reference/catalog.html">?catalog</a></code>).  </p>
</div>
<div id="prepare-for-analyses" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-for-analyses" class="anchor"></a><strong>Prepare for analyses</strong>
</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(warbleR)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># set your working directory appropriately</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># setwd("/path/to/working directory")</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co"># run this if you have restarted RStudio between vignettes without saving your workspace (assuming that you are in your /home/username directory)</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>(),<span class="st">"warbleR_example"</span>))</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"># Check your location</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">getwd</a></span>()</a></code></pre></div>
<p>This vignette series will not always include all available <code>warbleR</code> functions, as existing functions are updated and new functions are added. To see all functions available in this package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># The package must be loaded in your working environment</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ls">ls</a></span>(<span class="st">"package:warbleR"</span>)</a></code></pre></div>
</div>
<div id="quality-control-filtering-of-selections" class="section level2">
<h2 class="hasAnchor">
<a href="#quality-control-filtering-of-selections" class="anchor"></a><strong>Quality control filtering of selections</strong>
</h2>
<div id="find-overlapping-selections" class="section level3">
<h3 class="hasAnchor">
<a href="#find-overlapping-selections" class="anchor"></a>Find overlapping selections</h3>
<p>Overlapping selections can sometimes arise after selecting signals using other functions or software. The function below helps you detect overlapping signals in your selection table, and has arguments that you can play around with for overlap detection, renaming or deleting overlapping selections.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># To run this example:</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co"># Open Phae_hisnr.csv and modify the start coordinate of the first selection and the end coordinate of the second selection so that the signals overlap</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">Phae.hisnr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(<span class="st">"Phae_hisnr.csv"</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(Phae.hisnr)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(Phae.hisnr, <span class="dt">n =</span> <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co"># yields a data frame with an additional column (ovlp_sels) that indicates which selections overlap</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">Phae.hisnr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ovlp_sels.html">ovlp_sels</a></span>(<span class="dt">X =</span> Phae.hisnr, <span class="dt">max.ovlp =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co"># run the function again but this time retain only the signals that don't overlap</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">Phae.hisnr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ovlp_sels.html">ovlp_sels</a></span>(<span class="dt">X =</span> Phae.hisnr, <span class="dt">max.ovlp =</span> <span class="dv">0</span>, <span class="dt">drop =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="make-spectrograms-of-selections" class="section level3">
<h3 class="hasAnchor">
<a href="#make-spectrograms-of-selections" class="anchor"></a>Make spectrograms of selections</h3>
<p><code>specreator</code> generates spectrograms of individual selected signals. These image files can be used to filter out selections that were poorly made or represent signals that are not relevant to your analysis. This quality control step is important for visualizing your selected signals after any selection method, even if you imported your selections from <em>Raven</em> or <em>Syrinx</em>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/specreator.html">specreator</a></span>(Phae.hisnr, <span class="dt">wl =</span> <span class="dv">300</span>, <span class="dt">flim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="dt">it =</span> <span class="st">"jpeg"</span>, <span class="dt">res =</span> <span class="dv">150</span>, <span class="dt">osci =</span> <span class="ot">TRUE</span>, <span class="dt">ovlp =</span> <span class="dv">90</span>)</a></code></pre></div>
<p>Inspect spectrograms and throw away image files that are poor quality to prepare for later steps. Make sure you are working in a directory that only has image files associated with this vignette. Delete the image files corresponding to recording <em>154070</em> selection <em>8</em> and <em>154070</em> selection <em>12</em>, as the start coordinates for these selections are not accurate.</p>
</div>
<div id="remove-selections-with-missing-image-files" class="section level3">
<h3 class="hasAnchor">
<a href="#remove-selections-with-missing-image-files" class="anchor"></a>Remove selections with missing image files</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># remove selections after deleting corresponding image files</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">Phae.hisnr2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filtersels.html">filtersels</a></span>(Phae.hisnr, <span class="dt">it =</span> <span class="st">"jpeg"</span>, <span class="dt">incl.wav =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(Phae.hisnr2)</a></code></pre></div>
<p>After removing the poorest quality selections or signals, there are some other quality control steps that may be helpful.</p>
</div>
<div id="check-selections" class="section level3">
<h3 class="hasAnchor">
<a href="#check-selections" class="anchor"></a>Check selections</h3>
<p>Can selections be read by downstream functions? The function <code>checksels</code> also yields a data frame with columns for duration, minimum samples, sampling rate, channels and bits.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># if selections can be read, "OK" will be printed to check.res column</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="../reference/checksels.html">checksels</a></span>(Phae.hisnr2, <span class="dt">check.header =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>If selections cannot be read, it is possible the sound files are corrupt. If so, use the <code>fixwavs</code> function to repair <em>wav</em> files.</p>
</div>
<div id="tailor-temporal-coordinates-of-selections" class="section level3">
<h3 class="hasAnchor">
<a href="#tailor-temporal-coordinates-of-selections" class="anchor"></a>Tailor temporal coordinates of selections</h3>
<p>Sometimes the start and end times of selected signals need fine-tuned adjustments. This is particularly true when signals are found within bouts of closely delivered sounds that may be hard to pull apart, such as duets, or if multiple researchers use different rules-of-thumb to select signals. <code>seltailor</code> provides an interactive interface similar to <code>manualoc</code> for tailoring the temporal coordinates of selections.</p>
<p>If you check out the image files generated by running <code>specreator</code> above, you’ll see that some of the selections made during the automatic detection process with <code>autodetec</code> do not have accurate start and/or end coordinates.</p>
<p>For instance:</p>
<p>The end of this signal is not well selected. <!-- <center> ![End coordinate not well-selected](Phaethornis-longirostris-154070.wav-8_badend.jpeg)</center> -->  </p>
<p>The temporal coordinates for the tailored signals will be saved in a _ .csv_ file called <code>seltailor_output.csv</code>. You can rename this file and read it back into <code>R</code> to continue downstream analyses.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/seltailor.html">seltailor</a></span>(Phae.hisnr2, <span class="dt">wl =</span> <span class="dv">300</span>, <span class="dt">flim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">10</span>), <span class="dt">wn =</span> <span class="st">"hanning"</span>, <span class="dt">mar =</span> <span class="fl">0.1</span>, <span class="dt">osci =</span> <span class="ot">TRUE</span>, <span class="dt">title =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sound.files"</span>, <span class="st">"selec"</span>), <span class="dt">auto.next =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co"># Read in seltailor output after renaming the csv file</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">Phae.hisnrt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(<span class="st">"Phae_hisnrt.csv"</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(Phae.hisnrt)</a></code></pre></div>
<pre><code>'data.frame':   23 obs. of  6 variables:
 $ sound.files: Factor w/ 5 levels "Phaethornis-longirostris-154070.wav",..: 1 1 1 2 2 2 2 2 3 3 ...
 $ selec      : int  14 18 20 36 108 124 142 148 57 83 ...
 $ start      : num  8.66 11.08 12.19 22.6 76.04 ...
 $ end        : num  8.79 11.2 12.32 22.73 76.16 ...
 $ SNR        : num  11.7 11.6 10.2 15.5 15.3 ...
 $ tailored   : Factor w/ 1 level "y": 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<div id="visual-classification-of-selected-signals" class="section level2">
<h2 class="hasAnchor">
<a href="#visual-classification-of-selected-signals" class="anchor"></a><strong>Visual classification of selected signals</strong>
</h2>
<p>Visual classification of signals is fundamental to vocal repertoire analysis, and can also be useful for other questions. If your research focuses on assessing variation between individuals or groups, several <code>warbleR</code> functions can provide you with important information about how to steer your analysis. If there is discrete variation in vocalization structure across groups (e.g. treatments or geographic regions), visual classification of vocalizations will be useful.</p>
<div id="print-long-spectrograms-with-lspec" class="section level3">
<h3 class="hasAnchor">
<a href="#print-long-spectrograms-with-lspec" class="anchor"></a>Print long spectrograms with <code>lspec</code>
</h3>
<p>The function <code>lspec</code>that we used in the last vignette can also be a tool for visually classifying signals. Long spectrograms can be printed to classify signals by hand, or comments accompanying the selections can be printed over selected signals (for instance, if you used with <code>manualoc</code> argument <code>selcomm</code> during the selection process).</p>
<p>Here, we print the start and end of selections with a red dotted line, and the selection number printed over the signal. If a selection data frame contains a comments column, these will be printed with the selection number.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># highlight selected signals</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw"><a href="../reference/lspec.html">lspec</a></span>(Phae.hisnrt, <span class="dt">wl =</span> <span class="dv">300</span>, <span class="dt">flim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="dt">ovlp =</span> <span class="dv">10</span>, <span class="dt">sxrow =</span> <span class="dv">6</span>, <span class="dt">rows =</span> <span class="dv">15</span>, <span class="dt">it =</span> <span class="st">"jpeg"</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co"># concatenate lspec image files into a single PDF per recording</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co"># lspec images must be jpegs </span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="kw"><a href="../reference/lspec2pdf.html">lspec2pdf</a></span>(<span class="dt">keep.img =</span> <span class="ot">FALSE</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Check out the image file in your working directory. These will look very similar to the <code>lspec</code> images produced in vignette 1, but with red dotted lines indicating where the selected signals start and end.</p>
</div>
<div id="highlight-spectrogram-regions-with-color-spectro" class="section level3">
<h3 class="hasAnchor">
<a href="#highlight-spectrogram-regions-with-color-spectro" class="anchor"></a>Highlight spectrogram regions with <code>color.spectro</code>
</h3>
<p><code>color.spectro</code> allows you to highlight selections you’ve made within a short region of a spectrogram. In the example below we will use <code>color.spectro</code> to highlight neighboring songs. This function has a wide variety of uses, and could be especially useful for analysis of duets or coordinated singing bouts. This example is taken directly from the <code>color.spectro</code> documentation. If working with your own data frame of selections, make sure to calculate the frequency range for your selections beforehand using the function <code>frange</code>, which will come up in the next vignette.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># we will use Phaethornis songs and selections from the warbleR package</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Phae.long1"</span>, <span class="st">"selec.table"</span>))</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw">writeWave</span>(Phae.long1, <span class="st">"Phae.long1.wav"</span>) <span class="co">#save sound files </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co"># subset selection table</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co"># already contains the frequency range for these signals</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">st &lt;-<span class="st"> </span>selec.table[selec.table<span class="op">$</span>sound.files <span class="op">==</span><span class="st"> "Phae.long1.wav"</span>,]</a>
<a class="sourceLine" id="cb10-8" data-line-number="8"> </a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co"># read wave file as an R object</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">sgnl &lt;-<span class="st"> </span>tuneR<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tuneR/topics/readWave">readWave</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(st<span class="op">$</span>sound.files[<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"> </a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co"># create color column</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13">st<span class="op">$</span>colors &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"red2"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>)</a>
<a class="sourceLine" id="cb10-14" data-line-number="14"> </a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co"># highlight selections</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="kw"><a href="../reference/color.spectro.html">color.spectro</a></span>(<span class="dt">wave =</span> sgnl, <span class="dt">wl =</span> <span class="dv">300</span>, <span class="dt">ovlp =</span> <span class="dv">90</span>, <span class="dt">flim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="fl">8.6</span>), <span class="dt">collevels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">dB =</span> <span class="st">"B"</span>, <span class="dt">X =</span> st, <span class="dt">col.clm =</span> <span class="st">"colors"</span>, <span class="dt">base.col =</span> <span class="st">"skyblue"</span>,  <span class="dt">t.mar =</span> <span class="fl">0.07</span>, <span class="dt">f.mar =</span> <span class="fl">0.1</span>)</a></code></pre></div>
</div>
<div id="optimize-spectrogram-display-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#optimize-spectrogram-display-parameters" class="anchor"></a>Optimize spectrogram display parameters</h3>
<p><code>spec_param</code> makes a catalog or mosaic of the same signal plotted with different combinations of spectrogram display arguments. The purpose of this function is to help you choose parameters that yield the best spectrograms (e.g. optimal visualization) for your signals (although low signal-to-noise ratio selections may be an exception).</p>
<!-- <center> ![The spectrogram mosaic yielded by spec_param](Catalog_p2-spec_param.jpeg)</center> -->
<p> </p>
</div>
<div id="make-lexicons-of-signals" class="section level3">
<h3 class="hasAnchor">
<a href="#make-lexicons-of-signals" class="anchor"></a>Make lexicons of signals</h3>
<p>This section on <code>catalog</code> is taken from <a href="https://marce10.github.io/2017/03/17/Creating_song_catalogs.html">Marcelo Araya-Salas’s bioacoustics GitHub blog</a> with slight modifications.</p>
<p>When we are interested in geographic variation of acoustic signals, we usually want to compare spectrograms from different individuals and sites. This can be challenging when working with large numbers of signals, individuals and/or sites. <code>catalog</code> aims to simplify this task.</p>
<p>This is how it works:</p>
<ul>
<li>
<code>catalog</code> plots a matrix of spectrograms from signals listed in a selection table</li>
<li>the catalog files are saved as image files in the working directory (or path provided)</li>
<li>Several image files are generated if the signals do not fit in a single file</li>
<li>Spectrograms can be labeled or color-tagged to facilitate exploring variation related to the parameter of interest (e.g. site or song type if already classified)</li>
<li>A legend can be added to help match colors with tag levels
<ul>
<li>different color palettes can be used for each tag</li>
</ul>
</li>
<li>The duration of the signals can be “fixed” such that all the spectrograms have the same duration
<ul>
<li>faciltates comparisons</li>
</ul>
</li>
<li>You can control the number of rows and columns as well as the width and height of the output image</li>
</ul>
<p><code>catalog</code> allows you to group signals into biologically relevant groups by coloring the background of selected spectrograms accordingly. There is also an option to add hatching to tag labels, as well as filling the catalog with spectrograms by rows or columns of the selection table data frame, among other additional arguments. Check out <a href="https://marce10.github.io/2017/07/31/Updates_on_catalog_function.html">Marcelo’s post</a> on some recent updates to the <code>catalog</code> function.</p>
<p>The <code>move.imgs</code> function can come in handy when creating multiple catalogs to avoid overwriting previous image files, or when working through rounds of other image files. In this case, the first catalog we create has signals labeled, tagged and grouped with respective color and hatching levels. The second catalog we create will not have any grouping of signals whatsoever, and could be used for a test of inter-observer reliability. <code>move.imgs</code> helps us move the first catalog into another directory to save it from being overwritten when creating the second catalog.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># create a column of recording IDs for friendlier catalog labels</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">rec_ID &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(Phae.hisnrt), <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(Phae.hisnrt<span class="op">$</span>sound.files[x]), <span class="dt">split =</span> <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">3</span>], <span class="dt">pattern =</span> <span class="st">".wav$"</span>, <span class="dt">replacement =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">})</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">rec_ID</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">Phae.hisnrt<span class="op">$</span>rec_ID &lt;-<span class="st"> </span>rec_ID</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(Phae.hisnrt)</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co"># set color palette</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co"># alpha controls transparency for softer colors</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">cmc &lt;-<span class="st"> </span><span class="cf">function</span>(n) <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/palettes">cm.colors</a></span>(n, <span class="dt">alpha =</span> <span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="kw"><a href="../reference/catalog.html">catalog</a></span>(<span class="dt">X =</span> Phae.hisnrt, <span class="dt">flim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">height =</span> <span class="dv">10</span>, <span class="dt">width =</span> <span class="dv">10</span>, <span class="dt">tag.pal =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(cmc), <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">same.time.scale =</span> <span class="ot">TRUE</span>, <span class="dt">mar =</span> <span class="fl">0.01</span>, <span class="dt">wl =</span> <span class="dv">300</span>, <span class="dt">gr =</span> <span class="ot">FALSE</span>, <span class="dt">labels =</span> <span class="st">"rec_ID"</span>, <span class="dt">tags =</span> <span class="st">"rec_ID"</span>, <span class="dt">hatching =</span> <span class="dv">1</span>, <span class="dt">group.tag =</span> <span class="st">"rec_ID"</span>, <span class="dt">spec.mar =</span> <span class="fl">0.4</span>, <span class="dt">lab.mar =</span> <span class="fl">0.8</span>, <span class="dt">max.group.cols =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb11-15" data-line-number="15"></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="kw"><a href="../reference/catalog2pdf.html">catalog2pdf</a></span>(<span class="dt">keep.img =</span> <span class="ot">FALSE</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-17" data-line-number="17"></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co"># assuming we are working from the warbleR_example directory</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co"># the ~/ format does not apply to Windows</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co"># make sure you have already moved or deleted all other pdf files</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="kw"><a href="../reference/move.imgs.html">move.imgs</a></span>(<span class="dt">from =</span> <span class="st">"."</span>, <span class="dt">it =</span> <span class="st">"pdf"</span>, <span class="dt">create.folder =</span> <span class="ot">TRUE</span>, <span class="dt">folder.name =</span> <span class="st">"Catalog_image_files"</span>)</a></code></pre></div>
<center>
<img src="Catalog_p1.jpeg" alt="Catalog with labels, tags and groups">
</center>
<p> </p>
<p>You can also make lexicons for blind scoring, which could be useful for determining interobserver reliability.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># now create a catalog without labels, tags, groups or axes</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">Phae.hisnrt<span class="op">$</span>no_label &lt;-<span class="st"> ""</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co"># catalog(X = Phae.hisnrt, flim = c(1, 10), nrow = 4, ncol = 3, height = 10, width = 10, cex = 0.8, same.time.scale = TRUE, mar = 0.01, wl = 300, spec.mar = 0.4, rm.axes = TRUE, labels = "no_label", lab.mar = 0.8, max.group.cols = 5, img.suffix = "nolabel")</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="kw"><a href="../reference/catalog.html">catalog</a></span>(<span class="dt">X =</span> Phae.hisnrt, <span class="dt">flim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">height =</span> <span class="dv">10</span>, <span class="dt">width =</span> <span class="dv">10</span>, <span class="dt">tag.pal =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(cmc), <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">same.time.scale =</span> <span class="ot">TRUE</span>, <span class="dt">mar =</span> <span class="fl">0.01</span>, <span class="dt">wl =</span> <span class="dv">300</span>, <span class="dt">gr =</span> <span class="ot">FALSE</span>, <span class="dt">labels =</span> <span class="st">"no_label"</span>, <span class="dt">spec.mar =</span> <span class="fl">0.4</span>, <span class="dt">lab.mar =</span> <span class="fl">0.8</span>, <span class="dt">max.group.cols =</span> <span class="dv">5</span>, <span class="dt">img.suffix =</span> <span class="st">"nolabels"</span>)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="kw"><a href="../reference/catalog2pdf.html">catalog2pdf</a></span>(<span class="dt">keep.img =</span> <span class="ot">FALSE</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<!-- <center> ![Catalog without labels, tags and groups](Catalog_p2-nolabels.jpeg)</center> -->
<!-- &nbsp;  -->
<p>###<strong>Next vignette: Acoustic (dis)similarity, coordinated singing and simulating songs</strong></p>
<p>Here we finished the second phase of the <code>warbleR</code> workflow, which includes various options for quality control filtering or visual classification of signals that you can leverage during acoustic analysis. After running the code in this vignette, you should now have an idea of how to:</p>
<ul>
<li>how to perform quality control filtering of your selected signals, including visual inspection and tailoring temporal coordinates of spectrograms</li>
<li>use different methods for visual classification of signals, including:
<ul>
<li>long spectrograms</li>
<li>highlighted regions within spectrograms</li>
<li>catalogues or lexicons of individual signals</li>
</ul>
</li>
</ul>
<p>The next vignette will cover the third phase of the <em>warbleR</em> workflow, which includes methods to perform acoustic mesaurements as a batch process, an example of how to use these measurements for an analysis of geographic variation, coordinated singing analysis and a new function to simulate songs.</p>
<p>##<strong>Citation</strong></p>
<p>Please cite <code>warbleR</code> when you use the package:</p>
<p>Araya-Salas, M. and Smith-Vidaurre, G. (2017), warbleR: an R package to streamline analysis of animal acoustic signals. Methods Ecol Evol. 8, 184-191.</p>
<p>##<strong>Reporting bugs</strong> Please report any bugs <a href="https://github.com/maRce10/warbleR/issues">here</a>.  </p>
<p><font size="5"><a name="References">References</a></font></p>
<ol style="list-style-type: decimal">
<li>Araya-Salas, M. and G. Smith-Vidaurre. 2016. warbleR: an R package to streamline analysis of animal acoustic signals. <em>Methods in Ecology and Evolution</em>. doi: 10.1111/2041-210X.12624</li>
</ol>
<p> </p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#bioacoustics-in-r-with-warbler">Bioacoustics in R with <code>warbleR</code></a></li>
      <li><a href="#vignette-introduction"><strong>Vignette introduction</strong></a></li>
      <li><a href="#prepare-for-analyses"><strong>Prepare for analyses</strong></a></li>
      <li><a href="#quality-control-filtering-of-selections"><strong>Quality control filtering of selections</strong></a></li>
      <li><a href="#visual-classification-of-selected-signals"><strong>Visual classification of selected signals</strong></a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Marcelo Araya-Salas, Grace Smith-Vidaurre.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  
</body>
</html>
