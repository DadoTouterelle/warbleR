<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<center><font size="7"><b>warbleR: Acoustic (dis)similarity, coordinated singing and simulating songs</b></font></center> • warbleR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="&lt;center&gt;&lt;font size=">
</head>
<body>
<b>warbleR: Acoustic (dis)similarity, coordinated singing and simulating songs</b>" /&gt;
<meta property="og:description" content="warbleR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">warbleR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.24</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/maRce10/warbleR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip><center>
<font size="7"><b>warbleR: Acoustic (dis)similarity, coordinated singing and simulating songs</b></font>
</center></h1>
                        <h4 class="author"><center>
<a href="http://marceloarayasalas.weebly.com/">Marcelo Araya-Salas, PhD</a>
</center></h4>
                        <h4 class="author">
<center>
<a href="http://smith-vidaurre.com/">Grace Smith-Vidaurre</a>
</center>
</h4>
<p> </p>
            
            <h4 class="date"><center>
"2020-06-21"
</center></h4>
      
      <small class="dont-index">Source: <a href="https://github.com/maRce10/warbleR/blob/master/vignettes/warbleR_workflow_03.Rmd"><code>vignettes/warbleR_workflow_03.Rmd</code></a></small>
      <div class="hidden name"><code>warbleR_workflow_03.Rmd</code></div>

    </div>

    
    
<p> </p>
<center>
<img src="logo.png" alt="warbleR logo">
</center>
<p> </p>
<!-- <center> <h1><b>Acoustic (dis)similarity and coordinated singing</h1></b> </center> -->
<!-- <center> <i><font size="4">Marcelo Araya-Salas and Grace Smith Vidaurre</font></i> </center> -->
<!-- <center> 2020-06-21 </center> -->
<div id="bioacoustics-in-r-with-warbler" class="section level2">
<h2 class="hasAnchor">
<a href="#bioacoustics-in-r-with-warbler" class="anchor"></a>Bioacoustics in R with <code>warbleR</code>
</h2>
<p>Bioacoustics research encompasses a wide range of questions, study systems and methods, including the software used for analyses. The <code>warbleR</code> and <code>Rraven</code> packages leverage the flexibility of the <code>R</code> environment to offer a broad and accessible bioinformatics tool set. These packages fundamentally rely upon two types of data to begin bioacoustic analyses in R:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Sound files:</strong> Recordings in <em>wav</em> or <em>mp3</em> format, either from your own research or open-access databases like <em>xeno-canto</em></p></li>
<li><p><strong>Selection tables:</strong> Selection tables contain the temporal coordinates (start and end points) of selected acoustic signals within recordings</p></li>
</ol>
<div id="package-repositories" class="section level3">
<h3 class="hasAnchor">
<a href="#package-repositories" class="anchor"></a>Package repositories</h3>
<p>These packages are both available on <em>CRAN</em>: <a href="https://cran.r-project.org/package=warbleR"><code>warbleR</code></a>, <a href="https://cran.r-project.org/package=Rraven"><code>Rraven</code></a>, as well as on <em>GitHub</em>: <a href="https://github.com/maRce10/warbleR"><code>warbleR</code></a>, <a href="https://github.com/maRce10/Rraven"><code>Rraven</code></a>. The GitHub repository will always contain the latest functions and updates. You can also check out an article in <em>Methods in Ecology and Evolution</em> documenting the <code>warbleR</code> package <a href="#References"><sup>[1]</sup></a>.</p>
<p>We welcome all users to provide feedback, contribute updates or new functions and report bugs to warbleR's GitHub repository.</p>
<p>Please note that <code>warbleR</code> and <code>Rraven</code> use functions from the <a href="https://cran.r-project.org/package=seewave"><code>seewave</code></a>, <a href="https://cran.r-project.org/package=monitoR"><code>monitoR</code></a>, <a href="https://cran.r-project.org/package=tuneR"><code>tuneR</code></a> and <a href="https://cran.r-project.org/package=dtw"><code>dtw</code></a> packages internally. <code>warbleR</code> and <code>Rraven</code> have been designed to make bioacoustics analyses more accessible to <code>R</code> users, and such analyses would not be possible without the tools provided by the packages above. These packages should be given credit when using <code>warbleR</code> and <code>Rraven</code> by including citations in publications as appropriate (e.g. <code><a href="https://rdrr.io/r/utils/citation.html">citation("seewave")</a></code>).</p>
</div>
<div id="parallel-processing-in-warbler" class="section level3">
<h3 class="hasAnchor">
<a href="#parallel-processing-in-warbler" class="anchor"></a>Parallel processing in <code>warbleR</code>
</h3>
<p>Parallel processing, or using multiple cores on your machine, can greatly speed up analyses. All iterative <code>warbleR</code> functions now have parallel processing for Linux, Mac and Windows operating systems. These functions also contain progress bars to visualize progress during normal or parallel processing. See <a href="#References"><sup>[1]</sup></a> for more details about improved running time using parallel processing.</p>
</div>
</div>
<div id="vignette-introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#vignette-introduction" class="anchor"></a><strong>Vignette introduction</strong>
</h2>
<p>In the previous vignette, we performed quality control processing of selected signals and made lexicons for visual classification. Here we continue with the case study of microgeographic vocal variation in long-billed hermit hummingbirds, <em>Phaethornis longirostris</em> <a href="#References"><sup>[2]</sup></a> (and a short sidenote using <em>Tinamus major</em> for an example of a tonal signal) by:</p>
<ol style="list-style-type: decimal">
<li><p>Detecting signal frequency range</p></li>
<li><p>Extracting spectral entropy and frequency contours as time series</p></li>
<li>Comparing methods for quantitative analysis of signal structure
<ul>
<li>data set of 29 acoustic parameters</li>
<li>spectrographic cross-correlation</li>
<li>dynamic time warping on frequency contours</li>
</ul>
</li>
<li><p>Visually inspecting frequency contours</p></li>
<li><p>Measuring acoustic parameters as a batch-process across signals</p></li>
<li><p>Calculating pairwise acoustic (dis)similarity between signals</p></li>
<li><p>Analysis of geographic variation in <em>Phaethornis longirostris</em> songs</p></li>
</ol>
<p>We also include some examples at the end of the vignette of how to perform coordinated singing analysis and simulate songs.</p>
<p>This vignette can be run without an advanced understanding of <code>R</code>, as long as you know how to run code in your console. However, knowing more about basic <code>R</code> coding would be very helpful to modify the code for your research questions.</p>
<p>For more details about function arguments, input or output, read the documentation for the function in question (e.g. <code><a href="../reference/xcorr.html">?xcorr</a></code>).  </p>
</div>
<div id="prepare-for-analyses" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-for-analyses" class="anchor"></a><strong>Prepare for analyses</strong>
</h2>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">warbleR</span>)

<span class="co"># set your working directory appropriately</span>
<span class="co"># setwd("/path/to/working directory")</span>

<span class="co"># run this if you have restarted RStudio between vignettes without saving your workspace</span>
<span class="co"># assumes that you are in your /home/username directory</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"warbleR_example"</span>))

<span class="co"># Check your location</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()</pre></body></html></div>
<p>This vignette series will not always include all available <code>warbleR</code> functions, as existing functions are updated and new functions are added. To see all functions available in this package:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># The package must be loaded in your working environment</span>
<span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="st">"package:warbleR"</span>)</pre></body></html></div>
</div>
<div id="extract-acoustic-parameters-as-time-series" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-acoustic-parameters-as-time-series" class="anchor"></a><strong>Extract acoustic parameters as time series</strong>
</h2>
<div id="detect-frequency-range" class="section level3">
<h3 class="hasAnchor">
<a href="#detect-frequency-range" class="anchor"></a>Detect frequency range</h3>
<p><em>Raven</em> selection tables can return low and high frequencies in your selections (e.g. if <code>all.data</code> or <code>freq.cols</code> in <code>run_raven</code> or <code>imp.raven</code> is TRUE), but the accuracy of these frequency selections depends on how the signals themselves were selected. Below we demonstrate how to visualize and detect the frequency range in your selected signals using the functions <code>frange.detec</code> and <code>frange</code>, which have options for setting bandpass filters to exclude background noise or other non-target acoustic signals.</p>
<p><code>frange.detec</code> creates a plot that will print to your graphics device, and also outputs a data frame per recording with the frequency range. This data frame can be used in subsequent analyses if saved as an object. <code>frange.detec</code> works best with single signals. If used for a whole recording, <code>frange.detec</code> will pick up <em>all</em> sounds in the recording.</p>
<p>Finally, although we have been using <em>Phaethornis longirostris</em> vocalizations throughout these vignettes, these signals are harmonically structured. The functions for detecting frequency ranges, <code>frange</code> and <code>frange.detec</code> work best on tonal signals, so for this example we will use Great Tinamou ( <em>Tinamus major</em>) songs.</p>
<p>Download a tinamou recording from <em>xeno-canto</em>, make selections and visualize/detect frequency ranges.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">tin</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/querxc.html">querxc</a></span>(<span class="kw">qword</span> <span class="kw">=</span> <span class="st">'Tinamus'</span>, <span class="kw">download</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># select a single recording</span>
<span class="no">tin</span> <span class="kw">&lt;-</span> <span class="no">tin</span>[<span class="no">tin</span>$<span class="no">Recordist</span> <span class="kw">==</span> <span class="st">"Marcelo Araya-Salas"</span>, ]

<span class="co"># download this recording</span>
<span class="fu"><a href="../reference/querxc.html">querxc</a></span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">tin</span>, <span class="kw">download</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="../reference/mp32wav.html">mp32wav</a></span>()</pre></body></html></div>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># here we will use manualoc to select signals within this recording</span>
<span class="co"># display only part of the recording to make manualoc run faster</span>
<span class="fu"><a href="../reference/manualoc.html">manualoc</a></span>(<span class="kw">flist</span> <span class="kw">=</span> <span class="st">"Tinamus-major-154191.wav"</span>, <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">4</span>), <span class="kw">tdisp</span> <span class="kw">=</span> <span class="fl">60</span>)

<span class="co"># read the selections back into the global environment </span>
<span class="no">Tin.sels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"manualoc_output.csv"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">Tin.sels</span>)

<span class="co"># cut the original wave file by selections for frange.detec below</span>
<span class="fu">writeWave</span>(<span class="kw pkg">seewave</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/cutw.html">cutw</a></span>(<span class="fu">readWave</span>(<span class="st">"Tinamus-major-154191.wav"</span>), <span class="kw">from</span> <span class="kw">=</span> <span class="no">Tin.sels</span>$<span class="no">start</span>[<span class="fl">1</span>], <span class="kw">to</span> <span class="kw">=</span> <span class="no">Tin.sels</span>$<span class="no">end</span>[<span class="fl">1</span>], <span class="kw">f</span> <span class="kw">=</span> <span class="fl">44100</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"Wave"</span>), <span class="kw">filename</span> <span class="kw">=</span> <span class="st">"Tinamus-major-154191-1.wav"</span>)

<span class="fu">writeWave</span>(<span class="kw pkg">seewave</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/cutw.html">cutw</a></span>(<span class="fu">readWave</span>(<span class="st">"Tinamus-major-154191.wav"</span>), <span class="kw">from</span> <span class="kw">=</span> <span class="no">Tin.sels</span>$<span class="no">start</span>[<span class="fl">2</span>], <span class="kw">to</span> <span class="kw">=</span> <span class="no">Tin.sels</span>$<span class="no">end</span>[<span class="fl">2</span>], <span class="kw">f</span> <span class="kw">=</span> <span class="fl">44100</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"Wave"</span>), <span class="kw">filename</span> <span class="kw">=</span> <span class="st">"Tinamus-major-154191-2.wav"</span>)</pre></body></html></div>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># note that changing the threshold argument in combination with the bandpass argument can improve the detection</span>
<span class="fu"><a href="../reference/frange.detec.html">frange.detec</a></span>(<span class="fu">readWave</span>(<span class="st">"Tinamus-major-154191-1.wav"</span>), <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.5</span>), <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">3</span>), <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">15</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># here, giving a strict bandpass with very low threshold improves frange detection</span>
<span class="co"># since the curving end of the tinamou signal is lower amplitude than the rest of the signal</span>
<span class="fu"><a href="../reference/frange.detec.html">frange.detec</a></span>(<span class="fu">readWave</span>(<span class="st">"Tinamus-major-154191-1.wav"</span>), <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.5</span>), <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">3</span>), <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>The function <code>frange</code> allows you to simultaneously return the frequency ranges for all signals in a selection table, including the graphical output as <code>frange.detec</code>. Check out the resulting image file in your graphics device. In addition to image files, this function returns the original selection table, as a data frame with the newly calculated low and high frequency measurements.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># use arguments from frange.detec above</span>
<span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/frange.html">frange</a></span>(<span class="no">Tin.sels</span>, <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">res</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.5</span>), <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">fr</span>)</pre></body></html></div>
</div>
<div id="extract-spectral-entropy-as-a-time-series" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-spectral-entropy-as-a-time-series" class="anchor"></a>Extract spectral entropy as a time series</h3>
<p>Spectral entropy can be calculated as time series in selected signals and plotted onto image files. Previously, spectral entropy was only available as a sole measurement across a selection, as measured by <code>specan</code>. Check out the resulting image files in your working directory.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">Phae.hisnrt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"Phae_hisnrt.csv"</span>, <span class="kw">header</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">Phae.hisnrt</span>)

<span class="no">se</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sp.en.ts.html">sp.en.ts</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">img</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">img.suffix</span> <span class="kw">=</span> <span class="st">"sp.en.ts"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"b"</span>, <span class="kw">ovlp</span> <span class="kw">=</span> <span class="fl">90</span>, <span class="kw">sp.en.range</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">25</span>, <span class="fl">10</span>), <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">10</span>), <span class="kw">picsize</span> <span class="kw">=</span> <span class="fl">0.75</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">se</span>)</pre></body></html></div>
<div id="visualizing-frequency-contours-with-trackfreqs" class="section level4">
<h4 class="hasAnchor">
<a href="#visualizing-frequency-contours-with-trackfreqs" class="anchor"></a>Visualizing frequency contours with <code>trackfreqs</code>
</h4>
<p>The function <code>trackfreqs</code> allows you to create spectrograms and visualize the accuracy of dominant frequency and fundamental frequency measurements.</p>
<p>Use <code>trackfreqs</code> on all the recordings for which you want to extract frequency contours as a time series, or later, calculate other frequency measurements. Scroll through all the spectrograms to get a feeling for how well the frequency measurements will be performed across your recordings.</p>
<p>Running <code>trackfreqs</code> can allow you to decide which frequency parameters to use in subsequent analyses, namely <code>specan</code> and dynamic time warping methods. Also, ff the frequency measurements look acceptable with the bandpass setting used in <code>trackfreqs</code>, use that same bandpass while running <code>specan</code>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># Note that the dominant frequency measurements are almost always more accurate</span>
<span class="fu"><a href="../reference/trackfreqs.html">trackfreqs</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">10</span>), <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">12</span>), <span class="kw">it</span> <span class="kw">=</span> <span class="st">"jpeg"</span>)

<span class="co"># We can change the lower end of bandpass to make the frequency measurements more precise</span>
<span class="fu"><a href="../reference/trackfreqs.html">trackfreqs</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">10</span>), <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">12</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"purple"</span>, <span class="st">"orange"</span>), <span class="kw">pch</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">17</span>, <span class="fl">3</span>), <span class="kw">res</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">it</span> <span class="kw">=</span> <span class="st">"jpeg"</span>, <span class="kw">picsize</span> <span class="kw">=</span> <span class="fl">0.8</span>)</pre></body></html></div>
<!-- <center> ![trackfreqs image](Phaethornis-longirostris-154072.wav-108-trackfreqs.jpeg)</center> -->
<p> </p>
<p>Note that the fundamental frequency measurements are not always very accurate, so we will remove fundamental frequency measurements later on.</p>
</div>
</div>
<div id="extract-fundamental-or-dominant-frequency-contours-as-a-time-series" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-fundamental-or-dominant-frequency-contours-as-a-time-series" class="anchor"></a>Extract fundamental or dominant frequency contours as a time series</h3>
<p>These functions return a data frame that contains estimated frequency contours as a time series across each signal in the input data frame. You can also specify if you want to create image files with the estimated frequency contours plotted over spectrograms. You can change argument settings to better visualize the signals or change the estimation of the frequency contour. For instance, the argument <code>threshold</code> (as in <code>autodetec</code>) controls the amplitude threshold for estimating frequency values at each time point. Note that the fundamental frequency contour estimation can often have errors, and tends to perform best with more tonal signals. The frequency contours are those that can be visualized using <code>trackfreqs</code>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># Fundamental frequency contour</span>
<span class="no">ff_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ffts.html">ffts</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">20</span>, <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">15</span>, <span class="kw">img</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">img.suffix</span> <span class="kw">=</span> <span class="st">"ff"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"p"</span>, <span class="kw">ovlp</span> <span class="kw">=</span> <span class="fl">70</span>, <span class="kw">clip.edges</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">leglab</span> <span class="kw">=</span> <span class="st">"ffts"</span>, <span class="kw">ff.method</span> <span class="kw">=</span> <span class="st">"tuneR"</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">ff_df</span>)</pre></body></html></div>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># Dominant frequency contour</span>

<span class="co"># Uses seewave function dfreq by default</span>
<span class="no">df_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ffts.html">ffts</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">20</span>, <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">15</span>, <span class="kw">img</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">img.suffix</span> <span class="kw">=</span> <span class="st">"ff"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"p"</span>, <span class="kw">ovlp</span> <span class="kw">=</span> <span class="fl">70</span>, <span class="kw">clip.edges</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">leglab</span> <span class="kw">=</span> <span class="st">"ffts"</span>, <span class="kw">fsmooth</span> <span class="kw">=</span> <span class="fl">0.2</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_df</span>)</pre></body></html></div>
</div>
<div id="manually-tailor-frequency-contours-with-seltailor" class="section level3">
<h3 class="hasAnchor">
<a href="#manually-tailor-frequency-contours-with-seltailor" class="anchor"></a>Manually tailor frequency contours with seltailor</h3>
<p>The functions above to track/extract dominant and fundamental frequency contours perform best with more tonal signals. The frequency measurements for signals with harmonic structure tend to jump around, and might not always match your own visual tracking of frequency contours. If this is the case, you can use the function <code>seltailor</code> to fix frequency contours where individual frequency measurements are clearly far off from the frequency contour detected by the human eye. The <code>seltailor</code> function is the same used in vignette 2 in this series, but by changing a few arguments, you can use <code>seltailor</code> to fix frequency contours.</p>
<p>Note that manually fixing frequency contours might not make sense, depending on your question and/or the contour in question. For instance, a dominant frequency contour for a harmonic signal that jumps around and does not form a smooth contour may in fact be the truth, rather than mis-estimation of the contour. On the other hand, fundamental frequencies can be more easily traced by the human eye across a signal, so using <code>seltailor</code> to fix a frequency contour that jumps around the signal makes more sense.</p>
<p>When the new graphics window for <code>seltailor</code> appears, it will show spectrograms as we saw in vignette 2, but with frequency contours plotted as points over each spectrogram. To fix the frequency contour, click near the malaligned points to place them over the frequency contour that you detect by eye. <code>seltailor</code> makes a new <code>.csv</code> file in your working directory that merges your original data frame (below, <code>Phae.hisnrt</code>) with the modified frequency time series (below, <code>ff_df</code> with any modified frequency values). To check that your manual tracing improved frequency contours, you can use <code>trackfreqs</code> to make spectrograms with your new frequency contours plotted as custom contours.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># Use the original data frame of songs for the main seltailor dataset</span>
<span class="co"># the data frame with the fundamental frequency contours is provided for manual tracing</span>
<span class="fu"><a href="../reference/seltailor.html">seltailor</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">10</span>), <span class="kw">wn</span> <span class="kw">=</span> <span class="st">"hanning"</span>, <span class="kw">mar</span> <span class="kw">=</span> <span class="fl">0.1</span>,
 <span class="kw">osci</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sound.files"</span>, <span class="st">"selec"</span>), <span class="kw">auto.contour</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">ts.df</span> <span class="kw">=</span> <span class="no">ff_df</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.6</span>)

<span class="co"># rename your seltailor output csv as desired, then read it back into R</span>
<span class="no">mff</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"seltailor_output_mff.csv"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">mff</span>)

<span class="fu"><a href="../reference/trackfreqs.html">trackfreqs</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">10</span>), <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">12</span>), <span class="kw">it</span> <span class="kw">=</span> <span class="st">"jpeg"</span>, <span class="kw">custom.contour</span> <span class="kw">=</span> <span class="no">mff</span>)</pre></body></html></div>
</div>
<div id="count-inflections-across-frequency-contours" class="section level3">
<h3 class="hasAnchor">
<a href="#count-inflections-across-frequency-contours" class="anchor"></a>Count inflections across frequency contours</h3>
<p>This function calculates the modulation index for any frequency contour or time series. The function <code>specan</code> (see below) also calculates a modulation index for signals, but as a single value across the length of the signal.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">df_inf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/inflections.html">inflections</a></span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">df_df</span>, <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_inf</span>)</pre></body></html></div>
</div>
</div>
<div id="quantitative-measurements-of-acoustic-dissimilarity" class="section level2">
<h2 class="hasAnchor">
<a href="#quantitative-measurements-of-acoustic-dissimilarity" class="anchor"></a><strong>Quantitative measurements of acoustic (dis)similarity</strong>
</h2>
<div id="compare-methods-for-quantitative-analysis-of-signal-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-methods-for-quantitative-analysis-of-signal-structure" class="anchor"></a>Compare methods for quantitative analysis of signal structure</h3>
<p>This section on <code>compare.methods</code> is taken directly from <a href="https://marce10.github.io/2017/02/17/Choosing_the_right_method_for_measuring_acoustic_signal_structure.html">Marcelo Araya-Salas's bioacoustics blog</a> with slight modifications.</p>
<p>Bioacoustic research relies on quantifying the structure of acoustic signals and comparing that structure across behavioral/ecological contexts, groups or species. However, measuring signal structure in a way that fully accounts for the variation in the signals could be a tricky task. Some of the differences that are apparent by visual inspection of spectrograms might not be picked up by some analyses. Hence, choosing the most appropriate analytical approach is a critical step.</p>
<p>The <code>warbleR</code> function <code>compare.methods</code> attempts to facilitate method selection. This function produces graphs (as image files in the working directory) with spectrograms from 4 signals that allow visual inspection of the performance of acoustic analysis methods at comparing those signals. The signals are randomly picked up from the provided data frame (<code>X</code> argument), and the function compares 2 <code>warbleR</code>methods at a time. The methods available are: * cross-correlation by warbleR function <code>xcorr</code> * dynamic time warping on dominant frequency time series with <code>dfDTW</code> * dynamic time warping on fundamental frequency time series with <code>ffDTW</code> * spectral parameters with <code>specan</code></p>
<p>In the last vignette, we tailored selections of <em>Phaethornis longirostris</em> songs that were originally downloaded from <em>xeno-canto</em>, detected by <code>autodetec</code>and filtered by signal-to-noise ratio (SNR). Here we will pick up the workflow with these filtered and tailored selections, using the data frame <code>Phae.hisnrt</code>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">Phae.hisnrt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"Phae_hisnrt.csv"</span>, <span class="kw">header</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="../reference/compare.methods.html">compare.methods</a></span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">Phae.hisnrt</span>, <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">10</span>), <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">10</span>),
                <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">methods</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"XCORR"</span>, <span class="st">"dfDTW"</span>))</pre></body></html></div>
<p><code>compare.methods</code> will produce 10 image files in the working directory (since we specified <code>n = 10</code>) that look like this:</p>
<!-- <center> ![`compare.methods` image example](comp.meth-XCORR-dfDTW-6-10-11-18.jpeg)</center> -->
<p> </p>
<p>In this graphic, the acoustic pairwise distance between signals is shown next to the arrows linking them. The font color of a distance value corresponds to the font color of the method that generated it, as shown in the scatterplots (in this case black font represents XCORR distances). Distances are standardized, with 0 being the distance of a signal to itself and 1 the farthest pairwise distance in the pool of signals. Principal Component Analysis (<code>princomp</code> function) is applied to calculate distances when using spectral parameters (SP). In this case, the first 2 PC’s are used. Classical Multidimensional Scaling (also known as Principal Coordinates Analysis, <code>cmdscale</code> function) is used for all other methods. The image file name contains the methods being compared and the row number of the selections. This function internally uses a modified version of the <code>spectro</code> function from the <code>seewave</code> package to create spectrograms. Note that the spectrograms are all plotted with the same frequency and time scales.</p>
<p>Also note that the graphs contain 2 scatterplots (1 per method) of the acoustic space of all signals in the input data frame <code>X</code>. The position of the 4 signals in the spectrograms is highlighted in the acoustic space scatterplot. These graphics allow you to directly assess if the distances between signals in the acoustic space accurately represent the spectrographic similarity (e.g. how similar their acoustic structure looks in the spectrograms).</p>
<p>You can run <code>compare.methods</code> for any combination of the quantitative methods for assessing acoustic (dis)similarity mentioned above. Importantly, to include the SP method (spectral parameters measured by the function <code>specan</code>), you need a large enough dataset, as the PCA that summarizes the spectral parameters needs more units (rows) that variables (columns).</p>
</div>
<div id="measure-acoustic-parameters-with-specan" class="section level3">
<h3 class="hasAnchor">
<a href="#measure-acoustic-parameters-with-specan" class="anchor"></a>Measure acoustic parameters with specan</h3>
<p>We can now perform acoustic measurements with the function <code>specan</code>. This function relies on the temporal coordinates in selection tables to measure 29 parameters across selections. <code>specan</code> is a batch process that is faster than calculating measurements manually, e.g. one selection and recording at a time. <code>specan</code> uses and customizes several functions available in the <a href="https://cran.r-project.org/package=seewave"><code>seewave package</code></a>.</p>
<p>Use the bandpass filter to your advantage here, to filter out low or high background noise before performing measurements. Also note that changing the amplitude threshold will change the amplitude at which noises (including non-target signals) are detected for measurements.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/specan.html">specan</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">10</span>), <span class="kw">threshold</span> <span class="kw">=</span> <span class="fl">15</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(<span class="no">params</span>, <span class="st">"acoustic_parameters.csv"</span>, <span class="kw">row.names</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>Remove parameters derived from fundamental frequency (based on <code>trackfreqs</code> results).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">params</span> <span class="kw">&lt;-</span> <span class="no">params</span>[, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="st">"fun|peakf"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">params</span>), <span class="kw">invert</span> <span class="kw">=</span> <span class="fl">TRUE</span>)]</pre></body></html></div>
</div>
<div id="calculate-acoustic-parameters-by-song-type" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-acoustic-parameters-by-song-type" class="anchor"></a>Calculate acoustic parameters by song type</h3>
<p>In addition to calculating acoustic parameters per individual signals using <code>specan</code>, you can also calculate these acoustic parameters by song type (average, minimum and maximum values per song type group).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Phae.long1"</span>, <span class="st">"Phae.long2"</span>, <span class="st">"Phae.long3"</span>, <span class="st">"Phae.long4"</span>, <span class="st">"selec.table"</span>))
<span class="fu">writeWave</span>(<span class="no">Phae.long1</span>,<span class="st">"Phae.long1.wav"</span>)
<span class="fu">writeWave</span>(<span class="no">Phae.long2</span>,<span class="st">"Phae.long2.wav"</span>)
<span class="fu">writeWave</span>(<span class="no">Phae.long3</span>,<span class="st">"Phae.long3.wav"</span>)
<span class="fu">writeWave</span>(<span class="no">Phae.long4</span>,<span class="st">"Phae.long4.wav"</span>)

<span class="co"># Add a 'song' column</span>
<span class="no">selec.table</span>$<span class="no">song</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="fl">4</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="fl">3</span>)[<span class="fl">1</span>:<span class="fl">11</span>]

<span class="co"># Measure acoustic parameters</span>
<span class="no">sp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/specan.html">specan</a></span>(<span class="no">selec.table</span>, <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">11</span>), <span class="fl">300</span>, <span class="kw">fast</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Add song data</span>
<span class="no">sp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(<span class="no">sp</span>, <span class="no">selec.table</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sound.files"</span>, <span class="st">"selec"</span>))

<span class="co"># Caculate song-level parameters for all numeric parameters</span>
<span class="no">sng</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/song_param.html">song_param</a></span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">sp</span>, <span class="kw">song_colm</span> <span class="kw">=</span> <span class="st">"song"</span>, <span class="kw">parallel</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">pb</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">sng</span>)</pre></body></html></div>
</div>
<div id="dynamic-time-warping-of-frequency-contours" class="section level3">
<h3 class="hasAnchor">
<a href="#dynamic-time-warping-of-frequency-contours" class="anchor"></a>Dynamic time warping of frequency contours</h3>
<p>This section on dynamic time warping methods is taken directly from <a href="https://marce10.github.io/2016/09/12/Similarity_of_acoustic_signals_with_dynamic_time_warping_(DTW).html">Marcelo Araya-Salas's bioacoustics blog</a> with slight modifications.</p>
<p>The dynamic time warping methods in <code>warbleR</code> all rely on functions from the <code>dtw</code> package, and are available for both dominant and fundamental frequencies. <code>dfDTW</code> and <code>ffDTW</code> calculate the dominant and fundamental frequency contours, respectively, of each signal and compares using dynamic time warping. You can interpolate measurements across the frequency time series using the <code>length.out</code> argument.</p>
<p>These functions return a matrix of pairwise acoustic dissimilarity (e.g. acoustic "distance") measurements that can be used in analyses of acoustic similarity, as well as image files with the frequency contours plotted over the spectrograms. If you require only the time series without the dynamic time warping analysis for either the dominant or fundamental frequency, check out the functions <code>dfts</code>and <code>ffts</code>.</p>
<p>Note that as the <code>frange</code> and <code>frange.detec</code> functions, the dynamic time warping functions tend to work best on more tonal signals. Check out the resulting image files in your working directory.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># Harmonic Phaethornis signals </span>
<span class="no">dm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dfDTW.html">dfDTW</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">10</span>), <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">9</span>), <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">img</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">dm</span>)</pre></body></html></div>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># Tonal Tinamou signals</span>
<span class="no">Tin.sels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"Tinamus-major-154191_sels.csv"</span>, <span class="kw">header</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="no">dm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dfDTW.html">dfDTW</a></span>(<span class="no">Tin.sels</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">flim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.5</span>), <span class="kw">bp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>), <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">512</span>, <span class="kw">img</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">dm</span>)</pre></body></html></div>
<p>Check out <a href="https://marce10.github.io/2016/09/12/Similarity_of_acoustic_signals_with_dynamic_time_warping_(DTW).html">Marcelo's blog</a> for a great example of how to evaluate whether or not the dynamic time warping (dis)similarity measurements accurately represents acoustic differences.</p>
</div>
<div id="spectrographic-cross-correlation" class="section level3">
<h3 class="hasAnchor">
<a href="#spectrographic-cross-correlation" class="anchor"></a>Spectrographic cross-correlation</h3>
<p>Cross-correlation calculates the pairwise similarity of multiple signals by spectrogram cross-correlation. <code>xcorr</code> calculates a correlation of the amplitude values at each step by sliding one spectrogram over the other. This function is a modified version of the <code>corMatch</code> and <code>makeTemplate</code> functions from the package <code>monitoR</code>. <code>xcorr</code> runs over multiple signals and returns a list of output, including:</p>
<ul>
<li>a correlation statistic for each "sliding" step</li>
<li>the maximum (peak) correlation for each pairwise comparison</li>
</ul>
<p><code>xcorr</code> requires margins half the duration of the signal on either side of the signal (e.g. before and after the start and end coordinates). Signals that are very close to either the start or end of a recording may throw errors. Additionally, when sound files have been modified by bandpass filters, some pairwise cross-correlations may not work and the correlation matrix may contain <code>NA</code> values. <code>xcorr</code> now contains an argument to remove columns of the matrix that contain <code>NA</code> values, which will reduce the data in the matrix but also allow the matrix to be used in subsequent analyses.</p>
<p>Here our output is a matrix of peak correlation per pairwise comparison, with the recording-selection names as the matrix dimension names.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">xc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/xcorr.html">xcorr</a></span>(<span class="no">Phae.hisnrt</span>, <span class="kw">wl</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">xc</span>)</pre></body></html></div>
<p>To visualize the cross-correlation across all pairwise comparisons, we need can use the function <code>corrplot</code> from the package of the same name.</p>
</div>
</div>
<div id="analysis-of-geographic-variation-using-specan-measurements" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-geographic-variation-using-specan-measurements" class="anchor"></a>Analysis of geographic variation using <code>specan</code> measurements</h2>
<p>We can evaluate whether or not the observed variation in song structure is reflected by the meters we just measured. For this we will conduct a Principal Component Analysis on scaled (z-transformed) meters and look at the grouping of songs (data points) in the scatter plot.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># Run the PCA with only numeric variables of params</span>
<span class="no">pca</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">params</span>[, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">params</span>, <span class="no">is.numeric</span>)], <span class="kw">scale.</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Check loadings</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">pca</span>)</pre></body></html></div>
<pre><code>Importance of components:
                         PC1    PC2    PC3     PC4     PC5     PC6    PC7     PC8     PC9    PC10    PC11    PC12    PC13   PC14    PC15    PC16
Standard deviation     3.799 2.6465 1.7684 1.01130 0.93681 0.88418 0.8449 0.72613 0.63069 0.52078 0.44692 0.43914 0.41945 0.3552 0.23923 0.18924
Proportion of Variance 0.481 0.2335 0.1042 0.03409 0.02925 0.02606 0.0238 0.01758 0.01326 0.00904 0.00666 0.00643 0.00586 0.0042 0.00191 0.00119
Cumulative Proportion  0.481 0.7145 0.8187 0.85280 0.88205 0.90811 0.9319 0.94948 0.96274 0.97178 0.97844 0.98487 0.99073 0.9949 0.99685 0.99804
                          PC17    PC18    PC19    PC20    PC21    PC22      PC23
Standard deviation     0.15921 0.15130 0.07228 0.05806 0.03699 0.02449 2.283e-15
Proportion of Variance 0.00084 0.00076 0.00017 0.00011 0.00005 0.00002 0.000e+00
Cumulative Proportion  0.99888 0.99965 0.99982 0.99993 0.99998 1.00000 1.000e+00</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># Extract PCA scores</span>
<span class="no">pcascor</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">pca</span><span class="kw">[[</span><span class="fl">5</span>]])

<span class="co"># Plot the 2 first PCs</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">pcascor</span>[, <span class="fl">1</span>], <span class="no">pcascor</span>[, <span class="fl">2</span>], <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">params</span>$<span class="no">sound.files</span>), <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>,
     <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"PC1"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"PC2"</span>)

<span class="co"># Add recordings/individuals labels </span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="no">pcascor</span>[, <span class="fl">1</span>], <span class="no">params</span>$<span class="no">sound.files</span>, <span class="no">mean</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="no">pcascor</span>[, <span class="fl">2</span>], <span class="no">params</span>$<span class="no">sound.files</span>, <span class="no">mean</span>)

<span class="no">labs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">".wav"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">params</span>$<span class="no">sound.files</span>), <span class="kw">function</span>(<span class="no">x</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(<span class="no">x</span>, <span class="kw">split</span> <span class="kw">=</span> <span class="st">"-"</span>, <span class="kw">fixed</span> <span class="kw">=</span> <span class="fl">TRUE</span>)<span class="kw">[[</span><span class="fl">1</span>]][<span class="fl">3</span>]
  }, <span class="kw">USE.NAMES</span> <span class="kw">=</span> <span class="fl">FALSE</span>)))

<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="no">labs</span>, <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">0.75</span>)</pre></body></html></div>
<p><img src="warbleR_workflow_03_files/figure-html/unnamed-chunk-29-1.png" width="1604.16666666667"></p>
<p>Songs are grouped by sound file. As each sound file represents a single individual, this suggests that songs have individual signatures. Let's look at the song type level. First, we need to classify the songs by song type. We can check the spectrograms we previously created to do this.</p>
<!-- <center> ![song types](song_types_spectros.jpg)</center> -->
<p> </p>
<p>Songs from sound files 154070 and 154072 seem to belong to the same song type. Sound files 154129 and 154161 represent a different song type. Finally, the songs from each of the other 2 sound files have a unique structure, so each one represents a different song type. Sound file 154123 is represented here too, but in vignette 1 we decided against using signals from this recording. We can add this information to the plot by using symbols to represent song types.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># Create a song type variable</span>

<span class="co"># First, extract recording ID</span>
<span class="no">songtype</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">".wav"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">params</span>$<span class="no">sound.files</span>), <span class="kw">function</span>(<span class="no">x</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(<span class="no">x</span>, <span class="kw">split</span> <span class="kw">=</span> <span class="st">"-"</span>, <span class="kw">fixed</span> <span class="kw">=</span> <span class="fl">TRUE</span>)<span class="kw">[[</span><span class="fl">1</span>]][<span class="fl">3</span>]
  }, <span class="kw">USE.NAMES</span> <span class="kw">=</span> <span class="fl">FALSE</span>))

<span class="co"># Now change IDs for letters representing song types</span>
<span class="no">songtype</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"154070|154072"</span>, <span class="st">"A"</span>, <span class="no">songtype</span>)
<span class="no">songtype</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"154129|154161"</span>, <span class="st">"B"</span>, <span class="no">songtype</span>)
<span class="no">songtype</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"154138"</span>, <span class="st">"C"</span>, <span class="no">songtype</span>)

<span class="co"># Add song type as a variable representing symbol type</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">pcascor</span>[, <span class="fl">1</span>], <span class="no">pcascor</span>[, <span class="fl">2</span>], <span class="kw">col</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">params</span>$<span class="no">sound.files</span>),
<span class="kw">pch</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">songtype</span>)),
     <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"PC1"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"PC2"</span>)

<span class="co"># Add song type labels </span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="no">pcascor</span>[, <span class="fl">1</span>], <span class="no">songtype</span>, <span class="no">mean</span>)
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span>(<span class="no">pcascor</span>[, <span class="fl">2</span>], <span class="no">songtype</span>, <span class="no">mean</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">songtype</span>), <span class="kw">cex</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="warbleR_workflow_03_files/figure-html/unnamed-chunk-30-1.png" width="1604.16666666667"></p>
<p>Songs of the same song type are more similar (they cluster together). This PCA confirms that the visually obvious differences in the song structures are well described by the meters measured in <a href="https://cran.r-project.org/package=warbleR"><code>warbleR</code></a>. Likewise, it also confirms that we can detect biologically relevant differences from sound files that have undergone <em>mp3</em> compression and conversion back to <em>wav</em> format (see also <a href="#References"> <sup>[2]</sup></a>). Importantly, if this analysis were for publication we would have to run other filtering steps on the acoustic parameters generated by <code>specan</code>, including removing any collinear variables.</p>
</div>
<div id="coordinated-singing-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#coordinated-singing-analysis" class="anchor"></a>Coordinated singing analysis</h2>
<p><code>warbleR</code> contains functions to visualize and test whether or not singing bouts between individuals can be considered coordinated singing. The function <code>coor.graph</code> plots signals as polygons to better visualize overlap between these signals.</p>
<p>The function <code>coor.test</code> uses a Monte Carlo randomization test to determine whether or not the probability of finding overlapping songs in a singing event is less than or more than what you would expect by chance. <code>coor.test</code> can be run simultaneously for many singing events, if all are contained in a single data frame (see <code>coor.test</code> documentation for more information).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">sim.coor.sing</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">sim.coor.sing</span>)</pre></body></html></div>
<p>The <code>sim.coor.sing</code> dataset contains three types of singing bouts:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># save plots in a list</span>
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/coor.graph.html">coor.graph</a></span>(<span class="no">sim.coor.sing</span>, <span class="kw">it</span> <span class="kw">=</span> <span class="st">"jpeg"</span>, <span class="kw">img</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">res</span> <span class="kw">=</span> <span class="fl">300</span>)

<span class="co"># print list of plots to graphics device</span>
<span class="no">g</span></pre></body></html></div>
<p>We can test for overlapping or alternating coordinated singing using the <code>less.than.chance</code> argument in <code>coor.test</code>. Here we will test for alternating coordinated singing, since <code>less.than.chance</code> is set to <code>TRUE</code>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">cs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/coor.test.html">coor.test</a></span>(<span class="no">sim.coor.sing</span>, <span class="kw">iterations</span> <span class="kw">=</span> <span class="fl">1000</span>, <span class="kw">less.than.chance</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">cutoff</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">cs</span>)</pre></body></html></div>
</div>
<div id="simulating-songs" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-songs" class="anchor"></a>Simulating songs</h2>
<p>You can simulate songs using <code>warbleR</code>. Depending on your question, you can simulate songs with different numbers of subunits, subunit durations, numbers of harmonics, amplitudes, gaps between subunits, amplitude fading of subunits, among other options. Songs are simulated under Brownian motion frequency drift.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># simulate a song with 3 tonal elements</span>
<span class="no">ss</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_songs.html">sim_songs</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">harms</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="co"># plot the simulated song</span>
<span class="co"># seewave::spectro(ss)</span>

<span class="co"># simulate a song with 3 harmonic elements of differing amplitude</span>
<span class="no">ss</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_songs.html">sim_songs</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">harms</span> <span class="kw">=</span> <span class="fl">3</span>)

<span class="co"># plot the simulated song</span>
<span class="kw pkg">seewave</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html">spectro</a></span>(<span class="no">ss</span>)</pre></body></html></div>
<p> </p>
<p>This vignette concludes the <code>warbleR</code> vignette series. After running the code in this third vignette, you should now have an idea of how to:</p>
<ul>
<li>measure frequency range of signals</li>
<li>extract spectral entropy and frequency contours as time series</li>
<li>manually fix frequency contours (as appropriate)</li>
<li>compare and choose methods for acoustic (dis)similarity analysis</li>
<li>use different methods for acoustic (dis)similarity analysis
<ul>
<li>
<code>specan</code>- 29 parameters (across signals or song types)</li>
<li>
<code>dfDTW</code>and <code>ffDTW</code> - dynamic time warping on frequency contours</li>
<li>
<code>xcorr</code>- spectrographic cross-correlation</li>
</ul>
</li>
<li>carry out steps for an analysis of geographic variation in vocalizations</li>
<li>perform coordinated singing analysis</li>
<li>simulate songs for other research questions</li>
</ul>
<p>In these vignettes we presented examples of how the <code>warbleR</code> functions can be used in a streamlined workflow for flexible and rigorous bioacoustics analyses. The output of <code>warbleR</code> functions can be used in other packages for statistical analyses, such as machine learning.</p>
</div>
<div id="citation" class="section level2">
<h2 class="hasAnchor">
<a href="#citation" class="anchor"></a><strong>Citation</strong>
</h2>
<p>Please cite <code>warbleR</code> when you use the package:</p>
<p>Araya-Salas, M. and Smith-Vidaurre, G. (2017), warbleR: an R package to streamline analysis of animal acoustic signals. Methods Ecol Evol. 8, 184-191.</p>
</div>
<div id="reporting-bugs" class="section level2">
<h2 class="hasAnchor">
<a href="#reporting-bugs" class="anchor"></a><strong>Reporting bugs</strong>
</h2>
<p>Please report any bugs <a href="https://github.com/maRce10/warbleR/issues">here</a>.  </p>
<p><font size="5"><a name="References">References</a></font></p>
<ol style="list-style-type: decimal">
<li>Araya-Salas, M. and G. Smith-Vidaurre. 2016. warbleR: an R package to streamline analysis of animal acoustic signals. <em>Methods in Ecology and Evolution</em>. doi: 10.1111/2041-210X.12624</li>
</ol>
<p> </p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Marcelo Araya-Salas, Grace Smith-Vidaurre.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  
</body>
</html>
