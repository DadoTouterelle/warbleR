---
title: "Download sound files to begin warbleR workflow"
author: "Grace Smith Vidaurre"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Download sound files to begin warbleR workflow}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

This vignette assumes a basic understanding of R, such as loading packages after installment.  

Here we will work through how to use warbleR to download sound files from Xeno Canto. If you're interested in other organisms besides birds, or have you have your own sound files, you can still bypass the functions discussed here (see end of vignette). 

First, it's always important to have a working directory for your project. Then, you need to tell R you want to work there. For this example, create a working directory on your desktop. You'll need to change the username to your own before running the code below. 

```{r, eval=FALSE}
# If using Ubuntu or Windows
# dir.create("C:/Users/gracesmithvidaurre/Desktop/warbleR_example") 
# setwd("C:/Users/gracesmithvidaurre/Desktop/warbleR_example") 


# If using Mac OS X
# dir.create("~/Desktop/warbleR_example") 
# setwd("~/Desktop/warbleR_example")
```

NOTAS MARCELO lo anterior no funciona en Ubuntu. Que tal esto?
```{r, eval=FALSE}

dir.create(file.path(getwd(),"warbleR_example"))
setwd(file.path(getwd(),"warbleR_example"))


```

Next, we can query the Xeno Canto database for a species or genus that is of interest.
The function `querxc` has two types of output: 1) metadata of sound files accessed by the query word (geographic coordinates, recording quality, recorder, type of signal) and 2) the physical sound files. The type of output depends on the argument `download` is `TRUE` or `FALSE`. 

Some of the metadata is not reliable, such as type of signal or recording quality. These are characetristics of the sound files that you will need to explore with downstream functions before proceeding with data collection and analysis. 

You can query Xeno Canto by genus:

```{r, eval=FALSE}
?querxc

# Query Xeno Canto for all recordings of the hummingbird genus Phaethornis

# Save metadata as a data frame object when download = FALSE 
Phae <- querxc(qword = "Phaethornis", download = FALSE) 

```

Or you can query Xeno Canto by species:

```{r, eval=FALSE}
# Query Xeno Canto for all recordings of the species Phaethornis anthophilus

# Save metadata as a data frame object when download = FALSE 
Phae.aeth <- querxc(qword = "Phaethornis aethopygus", download = FALSE) 

```

If you're interested in questions in which the geographic coverage of the recordings is important (e.g. song geographic variation) , you should use the function `xcmaps` to visualize the geographic range of the recordings prior to downloading. 
`xcmaps` will create a tiff file per species in your current directory, or in the plot window of RStudio if img = FALSE.

```{r, eval=FALSE}
?xcmaps

# image type can be changed to jpeg if you do not have software to open tiff files 
xcmaps(Phae, img = TRUE, it = "tiff") 
xcmaps(Phae.aeth, img = TRUE, it = "tiff") 
```

Once you're sure that you want copies of the sound files, proceed by using `querxc` to download the recordings. Also, make sure to save physical copies of the metadata to your working directory.  

```{r, eval=FALSE}

# Physical sound files will be saved in your current directory when download = TRUE 
querxc(qword = "Phaethornis aethopygus", download = TRUE) 

# Save each data frame object as a physical .csv file
# solves the trouble of re-downloading this information after restarting RStudio
write.csv(Phae, "Phae.csv", row.names = FALSE)
write.csv(Phae.anth, "Phae.aeth.csv", row.names = FALSE)

```

Xeno Canto maintains sound files in .mp3, as these are compressed and smaller in size. We require .wav format for all downstream analyses, however. Compression from .wav to .mp3 and back involves a loss of information, but sound files that have undergone this transformation have been successfully used in publication by Marcelo Araya Salas.

To convert .mp3 to .wav, we can use the warbleR function `mp32wav`, which relies on a underlying function from `tuneR`. However, this function does not always work for different Windows or Mac OSX users, and it remains unclear as to why. This bug should be fixed in future versions of tuneR. If R aborts when running `mp32wav`, use an mp3 to wav converter online. 

After .mp3 files have been converted, we need to check that the .wav files and not corrupted and can be read into R (some .wav files cannot be read, despite being in .wav format).

```{r, eval=FALSE}
# Neither of these functions requires arguments
# But you should check you're in the right directory before executing them
# getwd()

mp32wav() 
 
checkwavs() 
 
```

Now you can create a list of filenames of all the .wav files you want to use in downstream analyses. 

```{r, eval=FALSE}

wvs <- list.files(pattern = "wav$") 

# use this function to delete any sound files you don't want to use (or even the
# entire example directory)
# here, the first four sound files are deleted
unlink(wvs[c(1,4)]) 

```
NOTAS MARCELO yo seleccionaria en base a la calidad o el tipo de vocalizacion, solo por seguir un ejemplo biologico

It's likely that you won't need or want to use Xeno Canto. Perhaps you're interested in mammalian or invertebrate bioacoustics. Or perhaps the avian species you work with is a mimid or cryptic, and you can't rely on others' acoustic or morphological identification. In any case, you'll have your own recordings and metadata. You can bypass the `querxc`, `xcmaps`, `mp32wav` and `checkwavs` functions, 
merely by specifying the directory in which you have your .wav files, prior to running downstream functions. Examples to follow in the next vignette. 

NOTAS MARCELO creo q mejor poner todo en un solo vignette


